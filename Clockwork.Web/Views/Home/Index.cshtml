@model Clockwork.Web.Models.CurrentTimeQuery
<script>

    window.onload = function () {
        var clientTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        document.getElementById('dropdown').value = clientTimezone;

    }

    function UserAction() {
        var IANAtimezone, params, xhttp, responseObj, adjustedTime;
        IANAtimezone = document.getElementById('dropdown').value; //find user selected timezone value
        params = IANAtimezone.replace("/", ","); //timezone is passed in url as id, remove any '/'
        xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                adjustedTime = new Date().toLocaleString("en-US", { timeZone: IANAtimezone }); // converts time and date format to the local standard (IANA timezones)
                selectedTimezone = new Date(adjustedTime);
                responseObj = JSON.parse(this.responseText);
                adjustedTime = adjustedTime.replace("T", " "); //cutting 'T' out of string to improve readability 
                adjustedTime = adjustedTime.substring(0, 21); //cutting out milliseconds
                responseObj.utcTime = responseObj.utcTime.replace("T", " ");
                responseObj.utcTime = responseObj.utcTime.substring(0, 19);
                responseObj.timezone = responseObj.timezone.replace("_", " ");
                document.getElementById("currentTimeQueryId").innerHTML = "Current Time Query ID: " + responseObj.currentTimeQueryId;
                document.getElementById("time").innerHTML = "Time: " + adjustedTime;
                document.getElementById("clientIp").innerHTML = "Client IP: " + responseObj.clientIp;
                document.getElementById("utcTime").innerHTML = "UTC Time: " + responseObj.utcTime;
                document.getElementById("timezone").innerHTML = "Time Zone: " + responseObj.timezone;
            }
        };
        xhttp.open("GET", "http://127.0.0.1:54963/api/currenttime/" + params, true);
        xhttp.setRequestHeader("Content-type", "application/json");
        xhttp.send();
    }
</script>
<body>
    <div class="col-lg-12">
        <div class="row mx-auto text-centered">
            <h4 id="apiheader">Choose a Timezone and Click Below to Call the API</h4>
        </div>
        <div class="row mx-auto">
            @Html.DropDownListFor(n => Model.TimezoneId, Model.TimezoneList,
               new { @class = "form-control mx-auto col-lg-5", title = "Timezone to display dates.", id="dropdown" })
        </div>
        <br />
        <div class="row">
            <button id="apibutton "class="mx-auto" type="submit" onclick="UserAction()">Get the time</button>
        </div>
    </div>

    <p id="currentTimeQueryId"></p>
    <p id="time"></p>
    <p id="clientIp"></p>
    <p id="utcTime"></p>
    <p id="timezone"></p>

</body>


